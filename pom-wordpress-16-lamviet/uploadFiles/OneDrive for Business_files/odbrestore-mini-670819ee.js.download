define("I9t",["require","exports","ww","W","oB","Eq","pO"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n._itemsStore=n.resources.consume(s.resourceKey);n._restoreOperationDataSource=n.resources.consume(o.restore);n._anomalyId=t.anomalyId;n._headers=t.headers;n._restoreToDateTime=t.restoreToDateTime;n._mostRecentActivityId=t.mostRecentActivityId;n._onResolve=t.onResolve;n._onReject=t.onReject;return n}t.prototype.onIsAvailable=function(){return!0};t.prototype.onExecute=function(e){var t=this;return this._restoreOperationDataSource.submitRestore({anomalyId:this._anomalyId,dateTime:this._restoreToDateTime,headers:this._headers,mostRecentActivityId:this._mostRecentActivityId}).then(function(e){t._onResolve(e);t._itemsStore.emptyAllOtherSets([]);return{resultType:r.ResultTypeEnum.Success,extraData:{RestoreTo:t._restoreToDateTime.toISOString(),ResourceLocation:e.resourceLocation}}},this._onReject)};return t})(i.default);t.default=u});
define("y9t",["require","exports","ww","r","Oe","y5e"],function(e,t,n,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.IMAGE_COUNT=3;return n}t.prototype.render=function(){var e=this.props,t=e.errorTitle,n=e.errorDetailedText,o=e.correlationId,u=e.errorCode,a=e.imageUrl,f=void 0===a?this._getRandomImage():a;return r.createElement("div",{className:"od-Error"},r.createElement("div",{className:"od-Error-image"},r.createElement("img",{className:"od-Error-imageTag",src:f,alt:t})),r.createElement("div",{role:"alert"},r.createElement("p",{className:"od-Error-title"},t),n&&r.createElement("p",{className:"od-Error-subText"},n),o&&r.createElement("p",{className:"od-Error-code"},i.format(s.default.errorCorrelationIdText,o)),u&&r.createElement("p",{className:"od-Error-code"},i.format(s.default.errorCodeText,u))))};t.prototype._getRandomImage=function(){var e=Math.ceil(Math.random()*this.IMAGE_COUNT);e=0===e?1:e;return window.require.toUrl("odsp-media/images/error/error"+e+".svg")};return t})(r.Component);t.default=o});
define("S9t",["require","exports","ww","dVe","Yb","A","C2","yce","r","Ve","Oe","hQ","i3t"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(t){n.__extends(r,t);function r(e){var n=t.call(this,e)||this,r=e.activitiesCountByDate,s=e.onSelectDate;n._async=new i.default;n._handleSliderChange=n._async.debounce(function(e){s(c.localTimezoneDate(c.dateNDaysAgo(30-e)))},500);n.state={chartOptions:n._getChartOptions(r)};return n}r.prototype.UNSAFE_componentWillReceiveProps=function(e){f.deepCompare(this.props.activitiesCountByDate,e.activitiesCountByDate)||this.setState({chartOptions:this._getChartOptions(e.activitiesCountByDate)})};r.prototype.componentWillUnmount=function(){this._async.dispose()};r.prototype.render=function(){var t=this.props.selectedDate,n=this.state.chartOptions;return a.createElement("div",null,a.createElement("div",{"aria-hidden":!0},a.createElement(d,{highchartsInstance:o.loadModule({path:"ZUe",getModule:function(){return s.default.resolve(new Promise(function(t,n){e(["ZUe"],t,n)}))}}),options:n})),a.createElement("div",{className:"od-Restore-datetime-selector-slider-container"},a.createElement(u.Slider,{className:"od-Restore-datetime-selector-slider",buttonProps:{className:"slider-button"},min:1,max:30,step:1,value:30-c.countDaysAgo(t),defaultValue:30,showValue:!1,onChange:this._handleSliderChange,ariaLabel:h.default.daySliderAriaLabel,ariaValueText:function(e){return l.format(h.default.daySliderEntryAriaLabel,c.countDaysAgo(t))}})))};r.prototype._getChartOptions=function(e){return{accessibility:{keyboardNavigation:{enabled:!1}},tooltip:{enabled:!1},chart:{animation:!1,height:130,spacingBottom:0,spacingLeft:0,spacingRight:0,type:"column"},legend:{enabled:!1},title:{text:null},xAxis:[{reversed:!0,tickWidth:0,tickInterval:1,title:{align:"low",y:-6,text:h.default.daysAgo,style:{fontSize:"10px"}},labels:{style:{fontSize:"10px"}}}],yAxis:{tickPixelInterval:20,labels:{enabled:!1},title:{text:null}},plotOptions:{column:{color:"#666666",pointRange:1.4}},series:[{name:"Histogram",type:"column",data:c.datesForLastNDays(30).map(function(t){for(var n=t.daysAgo,r=t.date,i=0,s=e;i<s.length;i++){var o=s[i];if(o.date===r)return[n,o.totalCount]}return[n,0]})}]}};return r})(a.Component);t.default=p;var d=(function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.shouldComponentUpdate=function(e){return this.props.options!==e.options};t.prototype.render=function(){return a.createElement(r.Chart,n.__assign({},this.props))};return t})(a.Component)});
define("e3t",["require","exports","ww","VSe","jP","Yb","Ee","Oe","Vi","qd","od","ug","r","Dne","_Q","r3t","i3t","a3t","t3t","hQ"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getActivityDescription=t.getDataListGroups=t.ActionIcon=t.FileIcon=void 0;var w=new s.default,E=40,S=43,x=(function(e){n.__extends(t,e);function t(t){var n,r=e.call(this,t)||this;r._handleActivitySelected=function(e,t){if(e){if(v.isPlaceholderItem(e))throw new Error("Expected an activity to be selected, but found a placeholder: "+JSON.stringify(e));r.props.onSelectActivity(e);r.props.onSelectedCountChange(t)}else{r.props.onSelectActivity(null);r.props.onSelectedCountChange(0)}};r._handleComputeDetailsListItems=function(e){r.setState({detailsListGroups:e})};r._handleRequestActivitiesPage=function(e,t){var n=r.props,i=n.onRequestFutureActivities,s=n.onRequestPastActivities;t===v.DataListPlaceholderDirection.Forward?s(e):i(e)};r._handleRequestActivitiesOnDate=function(e){(0,r.props.onRequestDateActivities)(e)};r.state={columns:(n=t.isRetinaSupported,[{key:"icon",fieldName:"icon",name:m.default.activityTypeColumnLabel,isIconOnly:!0,onRender:function(e){return v.isPlaceholderItem(e)?null:h.createElement(N,{activity:e})},className:"od-Restore-list-icon-cell",minWidth:8,maxWidth:8},{key:"change",fieldName:"type",name:m.default.changeColumnLabel,onRender:function(e){if(v.isPlaceholderItem(e))return h.createElement("div",null);var t=e.time.toLocaleTimeString(o.default.language);return A(e,t)},minWidth:200,maxWidth:300},{key:"fileIcon",fieldName:"fileIcon",name:m.default.fileTypeColumnLabel,isIconOnly:!0,onRender:function(e){return v.isPlaceholderItem(e)?null:h.createElement(T,{activity:e,isRetinaSupported:n})},className:"od-Restore-list-icon-cell",minWidth:8,maxWidth:8},{key:"filename",fieldName:"filename",name:m.default.fileNameColumnLabel,minWidth:300,onRender:function(e){if(v.isPlaceholderItem(e))return null;if(9===e.type){var t=e.action.rename.oldItem.name;e.action.rename.newItem&&e.action.rename.newItem.name?t+=" > "+e.action.rename.newItem.name:e.item&&(t+=" > "+e.item.name);return t}return e.item.name}}]),detailsListGroups:[],detailsListGroupsCollapsed:{},groups:L(t.activities,t.activitiesCountByDate),scrollOffset:0};return r}t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.viewedActivityIndex,r=t.viewedDate;this.setState(function(t){var i;i=n>=0?M(t.detailsListGroups,t.detailsListGroupsCollapsed,n):_(t.detailsListGroups,t.detailsListGroupsCollapsed,r);e._refreshScrollOffset(i);return{scrollOffset:i}})};t.prototype.componentDidUpdate=function(e,t){var n=this,r=this.props,i=r.viewedActivityIndex,s=r.viewedDate,o=i!==e.viewedActivityIndex&&i>=0,u=s!==e.viewedDate;(o||u)&&this.setState(function(e){var t;t=o?M(e.detailsListGroups,e.detailsListGroupsCollapsed,i):_(e.detailsListGroups,e.detailsListGroupsCollapsed,s);n._refreshScrollOffset(t);return{scrollOffset:t}})};t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.props.activities===e.activities&&this.props.activitiesCountByDate===e.activitiesCountByDate||this.setState({groups:L(e.activities,e.activitiesCountByDate)})};t.prototype.render=function(){var e=this,t=this.props,r=t.activities,i=t.selectedActivity,s=t.selectedActivityTime,o=this.state,u=o.columns,a=o.detailsListGroupsCollapsed,l=o.groups,p=o.scrollOffset;0;return h.createElement(y.default,{selectedItem:i||O(r,s),getKey:function(e){return v.isPlaceholderItem(e)?e.token:e.id},onSelectItem:this._handleActivitySelected,render:function(t){return h.createElement(c.ScrollablePane,{initialScrollPosition:p},h.createElement(v.default,{groups:l,onComputeDetailsListItems:e._handleComputeDetailsListItems,onRequestPageItems:e._handleRequestActivitiesPage,onRequestGroupItems:e._handleRequestActivitiesOnDate,render:function(r){0;return h.createElement(f.DetailsList,{groups:r.groups.map(function(e){return n.__assign(n.__assign({},e),{isCollapsed:!!a[e.key]})}),groupProps:n.__assign(n.__assign({},r.groupProps),{onRenderHeader:function(t,i){return r.groupProps.onRenderHeader(n.__assign(n.__assign({},t),{onToggleCollapse:function(r){var i=!r.isCollapsed;e.setState(function(e){var t;return{detailsListGroupsCollapsed:n.__assign(n.__assign({},e.detailsListGroupsCollapsed),(t={},t[r.key]=i,t))}});return t.onToggleCollapse(r)}}),i)},onToggleCollapseAll:function(t){e.setState(function(e){for(var n={},r=0,i=e.detailsListGroups;r<i.length;r++){n[i[r].key]=t}return{detailsListGroupsCollapsed:n}})}}),items:r.items,onRenderRow:r.onRenderRow,listProps:{renderedWindowsAhead:30,renderedWindowsBehind:30},columns:u,constrainMode:f.ConstrainMode.unconstrained,getGroupHeight:e._getGroupHeight,layoutMode:f.DetailsListLayoutMode.justified,onRenderDetailsHeader:function(e,t){return t(e)},selection:t,ariaLabel:m.default.detailsListAriaLabel,selectionPreservedOnEmptyClick:!0,setKey:"preventClearingSelection",usePageCache:!0})}}))}})};t.prototype._getGroupHeight=function(e){return E+S*e.count};t.prototype._refreshScrollOffset=function(e){var t=this;w.setTimeout(function(){t.setState(function(e){return{scrollOffset:e.scrollOffset+1}},function(){w.setTimeout(function(){t.setState({scrollOffset:e})},100)})},100)};return t})(h.Component);t.default=x;function T(e){var t=e.activity.item,n=t.driveItem&&t.driveItem.folder||t.isFolder?"folder":i.getIconNameFromItem({extension:b.extname(e.activity.item.name)}),s=p.getIconUrlRetina(e.isRetinaSupported,n,16);return h.createElement(r.FileTypeIconRenderer,{iconName:n,iconTitle:n,iconUrl:s,onClick:null,width:16})}t.FileIcon=T;function N(e){var t=d.matchActivity({Comment:function(){return"Unknown"},CommentResponse:function(){return"Unknown"},Create:function(){return"Add"},Delete:function(){return"Trash"},Edit:function(){return"Edit"},Mention:function(){return"Unknown"},Move:function(){return"FabricMovetoFolder"},Rename:function(){return"Rename"},Restore:function(){return"RevToggleKey"},RestoreVersion:function(){return"Refresh"},PointInTimeRestore:function(){return"Refresh"},Share:function(){return"Unknown"},Unknown:function(){return"Unknown"},Version:function(){return"Unknown"},Copy:function(){return"Copy"},AddShortcutToOneDrive:function(){return"Unknown"},RemoveShortcutFromOneDrive:function(){return"Unknown"}})(e.activity);return h.createElement(l.Icon,{iconName:t})}t.ActionIcon=N;function C(e){return g.isActivity(e)?e:{direction:e.direction===g.FetchDirection.Future?v.DataListPlaceholderDirection.Backward:v.DataListPlaceholderDirection.Forward,token:e.token}}var k=new Set;k.add(13);k.add(11);k.add(10);k.add(0);k.add(1);k.add(9);k.add(6);function L(e,t){for(var n,r=a.createFastMap(),i=0,s=e.length;i<s;i++){var f=e[i],l=i<s-1?e[i+1]:void 0;if(g.isActivity(f)){if(n&&n.date===b.localTimezoneDate(f.time)){n.items.push(f);continue}n={date:b.localTimezoneDate(f.time),items:[f]};r.set(n.date,n)}else if(n)if(f.direction!==g.FetchDirection.Past){if(!l)throw new Error('Found a "future" fetch placeholder ('+JSON.stringify(f)+") without a following activity");if(g.isPlaceholder(l))throw new Error('Found a "future" fetch placeholder ('+JSON.stringify(f)+") followed by an unexpected placeholder ("+JSON.stringify(l)+")");if(n.date!==b.localTimezoneDate(l.time)){n={date:b.localTimezoneDate(l.time),items:[f]};r.set(n.date,n)}else n.items.push(f)}else n.items.push(f)}return t.map(function(e){var t,n,i,s,a=r.get(e.date),f=e.totalCount,l=[];if(a&&a.items){f=(l=a.items.filter(function(e){if(!e)return!1;if(g.isPlaceholder(e))return!0;var t=e;return!!(t&&t.item&&t.item.name&&k.has(t.type))}).map(C)).length}return{key:e.date,name:(t=e.date,n=b.countDaysAgo(t),i=0===n?m.default.today:1===n?m.default.oneDayAgo:m.default.xDaysAgo,s=new Date(Date.parse(t)+60*new Date(t).getTimezoneOffset()*1e3).toLocaleDateString(o.default.language),u.format(m.default.groupTitleForDate,u.format(i,n),s)),count:f,items:l}}).filter(function(e){return e.count>0})}t.getDataListGroups=L;function A(e,t){var r=function(r){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];return u.format.apply(u,n.__spreadArrays([r,e.actors.length>0&&e.actors[0].displayName||m.default.unknownUser,t],i))};return d.matchActivity({Comment:function(){return r(m.default.activityDescriptionUnknown)},CommentResponse:function(){return r(m.default.activityDescriptionUnknown)},Copy:function(){return r(m.default.activityDescriptionCopy)},Create:function(){return r(m.default.activityDescriptionAdd)},Delete:function(){return r(m.default.activityDescriptionDelete)},Edit:function(){return r(m.default.activityDescriptionUpdate)},Mention:function(){return r(m.default.activityDescriptionUnknown)},Move:function(e){var t=e.action.move;return t&&t.to&&t.from?r(m.default.activityDescriptionMoveSourceDestination,t.from.isRoot?m.default.files:t.from.name,t.to.isRoot?m.default.files:t.to.name):t&&t.to?r(m.default.activityDescriptionMoveDestination,t.to.isRoot?m.default.files:t.to.name):t&&t.from?r(m.default.activityDescriptionMoveSource,t.from.isRoot?m.default.files:t.from.name):r(m.default.activityDescriptionMove)},Rename:function(){return r(m.default.activityDescriptionRename)},Restore:function(){return r(m.default.activityDescriptionRestore)},RestoreVersion:function(){return r(m.default.activityDescriptionUnknown)},PointInTimeRestore:function(){return r(m.default.activityDescriptionUnknown)},Share:function(){return r(m.default.activityDescriptionUnknown)},Unknown:function(){return r(m.default.activityDescriptionUnknown)},Version:function(){return r(m.default.activityDescriptionUnknown)},AddShortcutToOneDrive:function(){return r(m.default.activityDescriptionUnknown)},RemoveShortcutFromOneDrive:function(){return r(m.default.activityDescriptionUnknown)}})(e)}t.getActivityDescription=A;function O(e,t){if(!t)return null;for(var n=e.length-1;n>=0;n--){var r=e[n];if(g.isActivity(r)&&r.time>=t)return r}return null}function M(e,t,n){var r=-1,i=0;if(0===e.length)return i;for(var s=0,o=e.length;s<o;s++){var u=e[s];if(u.startIndex>=n)break;r=s;i+=t[u.key]?E:E+u.count*S}return i+(t[e[r].key]?0:S*(n-e[r].startIndex))}function _(e,t,n){for(var r=0,i=0,s=e.length;i<s;i++){var o=e[i];if(o.key<n)break;r+=t[o.key]?E:E+o.count*S}return r}});
define("v9t",["require","exports","ww","Ee","Oe","Zm","HA","nre","r","sQ","hQ","S9t","e3t","h9t","a3t","i3t","y9t"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n._handleClickExit=function(){var e=n.props;(0,e.onEngagementEvent)({name:e.scenarioName+".Exit.PointInTimeRestore.ExitButton.Click",isIntentional:!0});n.setState({showExitDialog:!0})};n._handleExitDialogConfirm=function(){var e=n.props,t=e.onEngagementEvent,r=e.onExitRestore;t({name:e.scenarioName+".ConfirmExit.PointInTimeRestore.ConfirmButton.Click",isIntentional:!0});r()};n._handleExitDialogCancel=function(){var e=n.props;(0,e.onEngagementEvent)({name:e.scenarioName+".CancelExit.PointInTimeRestore.CancelButton.Click",isIntentional:!0});n.setState({showExitDialog:!1})};n._handleClickRestore=function(){var e=n.props;(0,e.onEngagementEvent)({name:e.scenarioName+".Restore.PointInTimeRestore.RestoreButton.Click",isIntentional:!0});n.setState({showConfirmationDialog:!0})};n._handleDialogConfirm=function(e){var t=n.props,r=t.onEngagementEvent,i=t.onSubmitRestore,s=t.scenarioName,o=n.state,u=o.revertCount,a=o.restoreTarget;r({name:s+".Confirm.PointInTimeRestore.ConfirmButton.Click",extraData:{hoursAgo:l.countHoursAgo(a),restoreDateTime:a.toISOString(),revertCount:u},isIntentional:!0});i(e.nativeEvent,a)};n._handleDialogCancel=function(){var e=n.props;(0,e.onEngagementEvent)({name:e.scenarioName+".Cancel.PointInTimeRestore.CancelButton.Click",isIntentional:!0});n.setState({showConfirmationDialog:!1})};n._handleSelectDate=function(e){var t=n.props;(0,t.onEngagementEvent)({name:t.scenarioName+".SelectDate.PointInTimeRestore.HistogramSlider.Slide",extraData:{date:e},isIntentional:!0});n.setState({selectedDate:e})};n._handleSelectRestoreTarget=function(e){n.setState({datePreset:d.DatePreset.Custom,restoreTarget:e?e.time:null,selectedActivity:e})};n._handleSelectedCountChange=function(e){n.setState({revertCount:e})};n.state={datePreset:t.defaultPointOfInterest?"PointOfInterest:"+t.defaultPointOfInterest.id:null,restoreTarget:t.defaultPointOfInterest?t.defaultPointOfInterest.time:null,revertCount:0,selectedActivity:null,selectedDate:l.localTimezoneDate(l.dateNDaysAgo(0)),selectedPointOfInterest:null,showConfirmationDialog:!1,showExitDialog:!1};return n}t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.props.defaultPointOfInterest!==e.defaultPointOfInterest&&e.defaultPointOfInterest&&this.setState({datePreset:"PointOfInterest:"+e.defaultPointOfInterest.id,restoreTarget:e.defaultPointOfInterest.time})};t.prototype.render=function(){var e,t=this,g=this.props,w=g.activities,E=g.activitiesCountByDate,S=g.exitError,x=g.isExiting,T=g.isLoadingActivities,N=g.isLoadingActivitiesCountByDate,C=g.isOneDrive,k=g.restoreDocLibSetting,L=g.isRetinaSupported,A=g.isSubmittingRestore,O=g.pointOfInterestOffsets,M=g.pointsOfInterest,_=g.restorePageTitle,D=g.scenarioName,P=g.onEngagementEvent,H=g.onRequestDateActivities,B=g.onRequestPastActivities,j=g.onRequestFutureActivities,F=g.onSelectPointOfInterest,I=g.isFluent,q=this.state,R=q.datePreset,U=q.restoreTarget,z=q.selectedActivity,W=q.selectedDate,X=q.selectedPointOfInterest,V=q.showConfirmationDialog,$=q.showExitDialog,J=l.localTimezoneDate(l.dateNDaysAgo(0)),K=E.activitiesByDate.some(function(e){return e.date===J}),Q=l.localTimezoneDate(l.dateNDaysAgo(7)),G=E.activitiesByDate.some(function(e){return e.date>Q}),Y=l.localTimezoneDate(l.dateNDaysAgo(21)),Z=E.activitiesByDate.some(function(e){return e.date>Y});if(!0===k.isRestoreSupported)e=a.createElement("div",null,a.createElement("div",{className:"od-Restore-presets"},a.createElement(u.Dropdown,{className:"od-Restore-presets-dropdown",placeholder:v.default.datePresetsPlaceholder,label:v.default.datePresetsLabel,ariaLabel:v.default.datePresetsLabel,options:n.__spreadArrays(M.slice().sort(function(e,t){var n=e.time;return t.time.getTime()-n.getTime()}).map(function(e){return{key:"PointOfInterest:"+e.id,text:t._pointOfInterestDisplayString(e),data:e}}),M.length>0?[{key:"divider",text:"-",itemType:u.DropdownMenuItemType.Divider}]:[],K?[{key:d.DatePreset.Yesterday,text:v.default.datePresetYesterday,data:l.dateNDaysAgo(1)}]:[],G?[{key:d.DatePreset.OneWeekAgo,text:v.default.datePresetOneWeekAgo,data:l.dateNDaysAgo(7)}]:[],Z?[{key:d.DatePreset.ThreeWeeksAgo,text:v.default.datePresetThreeWeeksAgo,data:l.dateNDaysAgo(21)}]:[],[{key:d.DatePreset.Custom,text:v.default.datePresetCustom}]),selectedKey:R,onChange:function(e,n){P({name:D+".ChoosePreset.PointInTimeRestore.PresetDropdown.Select",extraData:{preset:n.key.toString()},isIntentional:!0});if(n.key===d.DatePreset.Custom)t.setState({datePreset:d.DatePreset.Custom,restoreTarget:null,revertCount:0});else if(n.key in d.DatePreset){var r=n.data;t.setState({datePreset:d.DatePreset[n.key],selectedActivity:null,selectedDate:b(E,r),restoreTarget:r,revertCount:y(E,l.localTimezoneDate(r))})}else{var i=n.data;r=i.time;F(i);t.setState({datePreset:n.key.toString(),selectedActivity:null,selectedDate:b(E,r),selectedPointOfInterest:i,restoreTarget:r,revertCount:-1})}}}),U&&a.createElement("div",{className:"od-Restore-target-hint"},i.format(v.default.restoreTargetHint,U.toLocaleString(r.default.language)))),a.createElement("div",{className:"od-Restore-actions"},a.createElement(s.PrimaryButton,{className:"od-Restore-button",disabled:!U,text:v.default.restore,onClick:this._handleClickRestore}),a.createElement(s.DefaultButton,{className:"od-Restore-exit-button",disabled:x,text:v.default.cancel,onClick:this._handleClickExit})),R&&a.createElement("div",{className:"od-Restore-details"},a.createElement("p",{className:"od-Restore-customPreset-description"},v.default.histogramHint),a.createElement("div",{className:"od-Restore-datetime-selector"},N?a.createElement("div",null):a.createElement(c.default,{activitiesCountByDate:E.activitiesByDate,selectedDate:W,onSelectDate:this._handleSelectDate}),a.createElement("p",{className:"od-Restore-customPreset-description"},v.default.activityListHint),a.createElement("div",{className:"od-Restore-list-container"},a.createElement(h.default,{activities:w?w.activities:[],activitiesCountByDate:E.activitiesByDate,isNextPageLoading:T,isRetinaSupported:L,onSelectActivity:this._handleSelectRestoreTarget,onSelectedCountChange:this._handleSelectedCountChange,onRequestFutureActivities:j,onRequestPastActivities:B,onRequestDateActivities:H,selectedActivity:z,selectedActivityTime:U,viewedActivityIndex:X&&X.id in O?O[X.id]:-1,viewedDate:W})))),V&&a.createElement(o.Dialog,{dialogContentProps:{type:o.DialogType.normal,title:C?v.default.oneDriveRestoreConfirmationTitle:v.default.docLibRestoreConfirmationTitle,subText:i.format(v.default.restoreTargetHint,U.toLocaleString(r.default.language))},hidden:!1,onDismiss:this._handleDialogCancel},a.createElement(o.DialogFooter,null,a.createElement(s.PrimaryButton,{disabled:A,onClick:this._handleDialogConfirm,text:v.default.restore}),a.createElement(s.DefaultButton,{disabled:A,onClick:this._handleDialogCancel,text:v.default.cancel}))),$&&a.createElement(o.Dialog,{dialogContentProps:{type:o.DialogType.normal,title:C?v.default.oneDriveExitConfirmationTitle:v.default.docLibExitConfirmationTitle,subText:C?v.default.oneDriveExitConfirmationDescription:v.default.docLibExitConfirmationDescription},hidden:!1,styles:function(e){return{main:{selectors:{"@media (min-width: 480px)":{maxWidth:"470px",minWidth:"400px"}}}}},onDismiss:this._handleExitDialogCancel},S&&a.createElement("div",{className:"od-Restore-error"},S),a.createElement(o.DialogFooter,null,a.createElement(s.PrimaryButton,{disabled:x,onClick:this._handleExitDialogConfirm,text:v.default.exitConfirmationConfirmLabel}),a.createElement(s.DefaultButton,{disabled:x,onClick:this._handleExitDialogCancel,text:v.default.exitConfirmationCancelLabel}))));else{var ee=window.require.toUrl("@ms/odsp-media/lib/images/error/error2.svg"),te="";switch(k.errorCode){case f.RestoreDisabledErrorCode.ForceCheckoutEnabled:te=v.default.forceCheckoutEnabledErrorDescription;break;case f.RestoreDisabledErrorCode.VersioningDisabled:case f.RestoreDisabledErrorCode.VersioningDisabledAndForceCheckoutEnabled:default:te=v.default.versioningDisabledErrorDescription}e=a.createElement("div",null,a.createElement("div",null,a.createElement(m.default,{errorTitle:v.default.restoreDisabled,errorDetailedText:te,errorCode:null,imageUrl:ee})),a.createElement("div",{className:"od-Restore-disabled-navigation"},a.createElement(s.DefaultButton,{className:"od-Restore-disabled-button",text:v.default.versioningSettings,onClick:function(){return t._handleClickVersionSettingsButton(k.versionSettingsLink)}}),a.createElement(s.DefaultButton,{className:"od-Restore-disabled-button",text:v.default.returnToLibrary,onClick:this._handleExitDialogConfirm})))}return a.createElement(p.default,{header:a.createElement("div",{className:"od-Restore-description"},C?v.default.oneDriveDescription:v.default.docLibDescription),restorePageTitle:_,isFluent:I},e)};t.prototype._pointOfInterestDisplayString=function(e){var t=v.default.defaultPointOfInterest;e.isRansomware?t=v.default.ransomwarePointOfInterest:e.isPointInTimeRestore&&(t=v.default.pointInTimeRestorePointOfInterest);return i.format(t,e.time.toLocaleString(r.default.language))};t.prototype._handleClickVersionSettingsButton=function(e){var t=this.props,n=t.onClickVersionSettingsButton;(0,t.onEngagementEvent)({name:t.scenarioName+".Navigate.PointInTimeRestore.VersionSettingsButton.Click",isIntentional:!0});n(e)};return t})(a.Component);t.default=g;function y(e,t){for(var n=0,r=0,i=e.activitiesByDate;r<i.length;r++){var s=i[r];s.date>=t&&(n+=s.totalCount)}return n}function b(e,t){for(var n=l.localTimezoneDate(t),r=e.activitiesByDate,i=r.length-1;i>=0;i--)if(r[i].date>=n)return r[i].date}});
define("D9t",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HELP_ARTICLE_URL=void 0;t.HELP_ARTICLE_URL="https://go.microsoft.com/fwlink/p/?linkid=866985"});
define("r3t",["require","exports","ww","r","qd","o3t","fB"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getDetailsListItems=t.getDetailsListGroups=t.partition3=t.DataListPlaceholderDirection=t.isDataItem=t.isPlaceholderItem=void 0;function u(e){return void 0!==e.token}t.isPlaceholderItem=u;function a(e){return void 0===e.token}t.isDataItem=a;var f;(function(e){e[e.Forward=0]="Forward";e[e.Backward=1]="Backward"})(f=t.DataListPlaceholderDirection||(t.DataListPlaceholderDirection={}));var l=(function(e){n.__extends(t,e);function t(t){var a=e.call(this,t)||this;a._handleRenderGroupHeader=function(e,t){var n=a.props.onRequestGroupItems;return r.createElement(s.default,{onDidMount:function(){if(!a._fetchedKeys.has(e.group.key)){a._fetchedKeys.add(e.group.key);n(e.group.key)}}},t(e))};a._handleRenderDetailsRow=function(e,t){var f,l;if(!u(e.item)){var c=void 0;o.isFeatureEnabled(o.AriaLabelForRestoreActivity)&&(c=null===(l=null===(f=null==e?void 0:e.item)||void 0===f?void 0:f.item)||void 0===l?void 0:l.name);return t(n.__assign(n.__assign(n.__assign({},e),{"data-selection-toggle":!0}),c?{checkButtonAriaLabel:c}:{}))}return r.createElement(s.default,{data:{item:e.item},onDidMount:a._handleDetailsRowMount,onDidUpdate:a._handleDetailsRowMount},t(n.__assign(n.__assign({},e),{"data-selection-disabled":!0,"data-selection-all-toggle":!0,checkboxVisibility:i.CheckboxVisibility.hidden})))};a._handleDetailsRowMount=function(e){var t=a.props.onRequestPageItems;if(e.data.item.token){if(a._fetchedKeys.has(e.data.item.token))return;a._fetchedKeys.add(e.data.item.token);t(e.data.item.token,e.data.item.direction)}};a._fetchedKeys=new Set;a.state={detailsListGroups:d(t.groups),detailsListItems:m(t.groups)};return a}t.prototype.componentDidMount=function(){var e=this.props.onComputeDetailsListItems,t=this.state;e(t.detailsListGroups,t.detailsListItems)};t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.groups,r=t.onComputeDetailsListItems;if(n!==e.groups){var i=d(n),s=m(n);this.setState({detailsListGroups:i,detailsListItems:s});r(i,s)}};t.prototype.render=function(){var e=this.props.render,t=this.state,n=t.detailsListGroups,r=t.detailsListItems;return e({groups:n,groupProps:{onRenderHeader:this._handleRenderGroupHeader},items:r,onRenderRow:this._handleRenderDetailsRow})};return t})(r.Component);t.default=l;function c(e){return e.items.length>0&&e.items.every(a)}function h(e){return c(e)?e.items.length:e.count}function p(e,t,n){for(var r=[],i=[],s=0,o=e.length;s<o;){if(!t(u=e[s]))break;r.push(u);s++}for(;s<o;){var u;if(!n(u=e[s]))break;i.push(u);s++}return[r,i,s<o?[]:e.slice(s)]}t.partition3=p;function d(e){for(var t=[],n=0,r=0,i=e.length;r<i;r++){var s=e[r],o=h(s);t.push({key:s.key,name:s.name,count:o,startIndex:n});n+=o}return t}t.getDetailsListGroups=d;function v(e,t){for(var n=[],r=0;r<t;r++)n[r]=e;return n}function m(e){return e.reduce(function(e,t){if(c(t))return e.concat(t.items);if(0===t.items.length)return e.concat(v({token:null},t.count));var n=p(t.items,a,u),r=n[0],i=n[1],s=n[2];if(0===i.length)throw new Error("Failed to find placeholders in group with key "+t.key);var o=t.count-(r.length+s.length),l=Math.floor(o/i.length),h=o-l,d=l?v({direction:f.Forward,token:i[0].token},l):[],m=h?v({direction:f.Backward,token:i[1].token},h):[];return e.concat(r,d,m,s)},[])}t.getDetailsListItems=m});
define("o3t",["require","exports","ww","r"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.componentDidMount=function(){var e=this.props.onDidMount;e&&e(this.props)};t.prototype.componentDidUpdate=function(){var e=this.props.onDidUpdate;e&&e(this.props)};t.prototype.render=function(){return r.Children.only(this.props.children)};return t})(r.Component);t.default=i});
define("g9t",["require","exports","ww","Oe","Zm","ak","r","Bq","b9t","hQ","i3t"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function c(e){return e.status===u.RestoreStatus.Completed?100:Math.floor(e.percentComplete)}var h=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.state={datePreset:null,restoreTarget:null,revertCount:0,selectedDate:f.localTimezoneDate(f.dateNDaysAgo(0)),showConfirmationDialog:!1};return n}t.prototype.render=function(){var e,t=this.props,n=t.returnToFilesViewUrl,f=t.isOneDrive,h=t.libraryTitle,p=t.onExitRestore,d=t.restore,v=t.restorePageTitle,m=t.combinedSiteLibraryTitle,g=t.isFluent,y=f?l.default.returnToOneDriveFilesView:r.format(l.default.returnToDocLibFilesView,h),b=f?l.default.oneDriveRestoreInProgressTitle:r.capitalize(r.format(l.default.docLibRestoreInProgressTitle,m));return o.createElement(a.default,{restorePageTitle:v,isRestoreComplete:d.status===u.RestoreStatus.Completed,title:(e={},e[u.RestoreStatus.Cancelled]=f?l.default.oneDriveRestoreCanceledTitle:r.capitalize(r.format(l.default.docLibRestoreCanceledTitle,m)),e[u.RestoreStatus.CancelPending]=f?l.default.oneDriveRestoreCanceledTitle:r.capitalize(r.format(l.default.docLibRestoreCanceledTitle,m)),e[u.RestoreStatus.Completed]=f?l.default.oneDriveRestoreCompletedTitle:r.capitalize(r.format(l.default.docLibRestoreCompletedTitle,m)),e[u.RestoreStatus.Failed]=l.default.restoreFailedTitle,e[u.RestoreStatus.NotStarted]=b,e[u.RestoreStatus.InProgress]=b,e[u.RestoreStatus.Unknown]=l.default.restoreFailedTitle,e)[d.status],isFluent:g},o.createElement(s.ProgressIndicator,{className:"od-Restore-progress-indicator",description:r.format(l.default.percentComplete,c(d)),percentComplete:c(d)/100}),n&&o.createElement(i.PrimaryButton,{onClick:p,text:y,autoFocus:!0}))};return t})(o.Component);t.default=h});
define("p9t",["require","exports","ww","r","hQ","Oe","v9t","g9t","i3t","b9t","_9t","fB","ODBRestore_mini_css"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.state={datePreset:null,restoreTarget:null,restorePageTitle:"",revertCount:0,selectedDate:i.localTimezoneDate(i.dateNDaysAgo(0)),showConfirmationDialog:!1};return n}t.prototype.componentDidMount=function(){var e=this.props,t=e.combinedSiteLibraryTitle,n=e.isOneDrive?a.default.oneDriveRestoreTitle:s.format(a.default.docLibRestoreTitle,t);this.setState({restorePageTitle:n});c.isFeatureEnabled(c.SetRestorePageTitle)&&(document.title=n)};t.prototype.render=function(){var e=this.props,t=e.activities,n=e.activitiesCountByDate,i=e.combinedSiteLibraryTitle,s=e.defaultPointOfInterest,c=e.returnToFilesViewUrl,h=e.isExiting,p=e.isLoadingActivities,d=e.isLoadingActivitiesCountByDate,v=e.isLoadingInitialActivities,m=e.isLoadingRestoreStatus,g=e.isOneDrive,y=e.restoreDocLibSetting,b=e.isRetinaSupported,w=e.isSubmittingRestore,E=e.libraryTitle,S=e.pointOfInterestOffsets,x=e.pointsOfInterest,T=e.restore,N=e.restoreProgressError,C=e.restoreSubmitError,k=e.scenarioName,L=e.vaultNeedsVerification,A=e.exitError,O=e.onClickVersionSettingsButton,M=e.onEngagementEvent,_=e.onExitRestore,D=e.onSelectPointOfInterest,P=e.onSubmitRestore,H=e.onRequestFutureActivities,B=e.onRequestPastActivities,j=e.onRequestDateActivities,F=e.onVaultVerify,I=e.isFluent,q=this.state.restorePageTitle;if(L&&!m)return r.createElement(l.default,{isFluent:I,restorePageTitle:q,onVaultVerify:F});if(t.error||n.error){var R=t.error||n.error;return r.createElement(f.default,{isFluent:I,restorePageTitle:q,title:a.default.activitiesServerError},R.toString())}return N?r.createElement(f.default,{isFluent:I,restorePageTitle:q,title:a.default.restoreProgressServerError},N.toString()):A?r.createElement(f.default,{isFluent:I,restorePageTitle:q,title:a.default.exitServerError},A.toString()):C?r.createElement(f.default,{isFluent:I,restorePageTitle:q,title:a.default.restoreSubmitServerError},C.toString()):v||m?r.createElement(f.default,{isFluent:I,restorePageTitle:q,isLoading:!0}):T?r.createElement(u.default,{returnToFilesViewUrl:c,isOneDrive:g,libraryTitle:E,onExitRestore:function(){return _(!1)},restore:T,restorePageTitle:q,combinedSiteLibraryTitle:i,isFluent:I}):r.createElement(o.default,{activities:t,activitiesCountByDate:n,defaultPointOfInterest:s,exitError:A,isExiting:h,isLoadingActivities:p,isLoadingActivitiesCountByDate:d,isOneDrive:g,isRetinaSupported:b,isSubmittingRestore:w,pointOfInterestOffsets:S,pointsOfInterest:x,restoreDocLibSetting:y,restorePageTitle:q,scenarioName:k,onEngagementEvent:M,onExitRestore:function(){return _(!0)},onClickVersionSettingsButton:O,onRequestFutureActivities:H,onRequestPastActivities:B,onRequestDateActivities:j,onSelectPointOfInterest:D,onSubmitRestore:P,isFluent:I})};return t})(r.Component);t.default=h});
define("f9t",["require","exports","ww","ou","A","r","Vi","t8e","I9t","Bq","D9t","hQ","d3t","p9t","a3t"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.updateActivities=t.pruneInvalidFetchTokens=t.insertPlaceholders=t.mergeActivities=void 0;var v=(function(e){n.__extends(t,e);function t(t){var r=e.call(this,t)||this;r._handleEngagementEvent=function(e){r.props.engagement.logData(e)};r._handleRequestPastActivities=function(e){r._fetchActivities({direction:d.FetchDirection.Past,token:e})};r._handleRequestFutureActivities=function(e){r._fetchActivities({direction:d.FetchDirection.Future,token:e})};r._handleRequestDateActivities=function(e){r._fetchActivitiesOnSpecificDate(e)};r._handleExitRestore=function(e){var t=r.props,n=t.isWebViewHosted,i=t.navigation,s=t.ransomwareDetectionProvider,o=r.state.returnToFilesViewUrl,u=function(){n?window.close():i.navigateTo({url:o,ignoreHistory:!0})};if(e&&s){r.setState({isUpdatingAnomalyState:!0});s.updateActiveAnomalyState(3).then(function(){r.setState({isUpdatingAnomalyState:!1});u()},function(e){r.setState({isUpdatingAnomalyState:!1,updateAnomalyStateError:e});throw e})}else u()};r._handleClickNavigateToSettings=function(e){r.props.navigation.navigateTo({url:e})};r._handleSelectPointOfInterest=function(e){var t=r.props.restoreActivitiesDataSource,i=r.state.pointOfInterestOffsets;e.id in i||t.getActivityOffsetFromDateTime(e.time).then(function(t){r.setState(function(r){var i;return{pointOfInterestOffsets:n.__assign(n.__assign({},r.pointOfInterestOffsets),(i={},i[e.id]=t,i))}})})};r._handleSubmitRestore=function(e,t){var n=r.props.restoreOperationProgressProvider;r.setState({isSubmittingRestore:!0});r._submitRestore(e,t).then(function(e){r.setState({isLoadingRestoreStatus:!0,isSubmittingRestore:!1});n.pollRestoreProgress(function(e,t,n){r.setState({isLoadingRestoreStatus:!1,restore:t,restoreProgressError:e||null});e?n():t&&!m(t)||n()},h.getCVHeader(h.getCVValue(r._mscvBase)),!0);n.monitorRestoreProgress(h.getCVHeader(h.getCVValue(r._mscvBase)),!0)},function(e){r.setState({isSubmittingRestore:!1,restoreSubmitError:e})})};r._vaultVerify=function(){var e=r.props,t=e.resources,n=e.engagement,s=e.actionMap,o=e.ransomwareDetectionProvider,a=new(t.injected(s.VaultAction))({actionType:u.default.Unlock,shouldShowFRE:!1});n.logData({name:"Vault.Restore.Unlock"});return a.execute({}).then(function(e){r.setState({vaultNeedsVerification:!1});return o?o.checkActiveAnomalies():i.default.resolve()})};r._mscvBase=h.getCVBase();r.state={activities:{activities:[],isPlaceholder:!1,success:!1},activitiesWithPlaceholders:{activities:[]},activitiesCountByDate:{activitiesByDate:[],success:!1},activitiesFetchTokensFuture:{},activitiesFetchTokensPast:{},anomaly:null,returnToFilesViewUrl:null,isLoadingActivities:!0,isLoadingActivitiesCountByDate:!0,isLoadingInitialActivities:!0,isLoadingRestoreStatus:!0,isOneDrive:!0,restoreDocLibSetting:{isRestoreSupported:!0},isSubmittingRestore:!1,isUpdatingAnomalyState:!1,pointOfInterestOffsets:{},pointsOfInterest:[],pointsOfInterestError:null,restoreProgressError:null,vaultNeedsVerification:null,restoreEligible:null};return r}t.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.bundleLoader,r=t.engagement,i=t.navigation,s=t.observables,o=t.ransomwareDetectionProvider,u=t.restoreActivitiesDataSource,a=t.restoreOperationProgressProvider,f=t.urlDataSource;n.pageLoaded("Restore");r.logData({name:u.getScenarioName()+".Navigate.PointInTimeRestore.RestorePage.Load",isIntentional:!1});u.getRestoreEligibility().then(function(t){var n=3!==t;e.setState({restoreEligible:n});if(n){if(o){o.checkActiveAnomalies();s.compute(function(){if(o.activeAnomaly())e.setState({anomaly:o.activeAnomaly()});else if(1!==t){i.navigateTo({url:l.HELP_ARTICLE_URL});return}})}e.props.vaultDataSource&&n&&e.props.vaultDataSource.isVaultDisabled().then(function(t){t||e._listenForVaultChanges()});e._fetchActivities();e._fetchActivitiesByDate();e._fetchPointsOfInterest();a.pollRestoreProgress(function(t,n,r){(function(t,n,r){e.setState(function(e){return{isLoadingRestoreStatus:!1,restore:n&&!e.restore&&m(n)?e.restore:n,restoreProgressError:t||null}});t?r():n&&!m(n)||r()})(t,n,r)},h.getCVHeader(h.getCVValue(e._mscvBase)),!0);e.setState({returnToFilesViewUrl:f.getRootUrl()})}else i.navigateTo({url:l.HELP_ARTICLE_URL})});u.isRestoreSupported().then(function(t){e.setState({restoreDocLibSetting:t})})};t.prototype.render=function(){var e=this.props,t=e.platformDetection,n=e.restoreActivitiesDataSource,i=e.isFluent,o=this.state,u=o.activitiesWithPlaceholders,a=o.activitiesCountByDate,f=o.returnToFilesViewUrl,l=o.isLoadingActivities,c=o.isLoadingActivitiesCountByDate,h=o.isLoadingInitialActivities,d=o.isLoadingRestoreStatus,v=o.restoreDocLibSetting,m=o.isSubmittingRestore,g=o.isUpdatingAnomalyState,y=o.pointOfInterestOffsets,b=o.pointsOfInterest,w=o.pointsOfInterestError,E=o.restore,S=o.restoreProgressError,x=o.restoreSubmitError,T=o.updateAnomalyStateError,N=o.vaultNeedsVerification;return o.restoreEligible?s.createElement(p.default,{activities:u,activitiesCountByDate:a,combinedSiteLibraryTitle:n.getCombinedSiteLibraryTitle(),returnToFilesViewUrl:f,defaultPointOfInterest:this._getSuggestedPointOfInterest(b),exitError:T,isExiting:g,isLoadingActivities:l,isLoadingActivitiesCountByDate:c,isLoadingInitialActivities:h,isLoadingRestoreStatus:d,isOneDrive:n.isOneDrive(),restoreDocLibSetting:v,isRetinaSupported:t.isRetinaSupported,isSubmittingRestore:m,libraryTitle:n.getLibraryTitle(),pointOfInterestOffsets:y,pointsOfInterest:b,pointsOfInterestError:w,restore:E,restoreProgressError:S,restoreSubmitError:x,scenarioName:n.getScenarioName(),vaultNeedsVerification:!!N,onEngagementEvent:this._handleEngagementEvent,onExitRestore:this._handleExitRestore,onClickVersionSettingsButton:this._handleClickNavigateToSettings,onSelectPointOfInterest:this._handleSelectPointOfInterest,onSubmitRestore:this._handleSubmitRestore,onRequestFutureActivities:this._handleRequestFutureActivities,onRequestPastActivities:this._handleRequestPastActivities,onRequestDateActivities:this._handleRequestDateActivities,onVaultVerify:this._vaultVerify,isFluent:i}):s.createElement(r.Spinner,{size:r.SpinnerSize.large})};t.prototype._listenForVaultChanges=function(){var e=this,t=this.props,n=t.observables,r=t.vaultDataSource;n.compute(function(){var t=r.isVaultOpen()();e.setState({vaultNeedsVerification:!t})})};t.prototype._fetchActivities=function(e){var t=this,n=this.props.restoreActivitiesDataSource;0;this.setState({isLoadingActivities:!0});return n.getActivities({headers:h.getCVHeader(h.getCVValue(this._mscvBase)),pageSize:25,sortAscending:e&&e.direction===d.FetchDirection.Future,nextRequestToken:e&&e.token}).then(function(n){t.setState(function(t){0;var r=w(t,n,{nextFutureToken:e&&e.direction===d.FetchDirection.Future?n.nextRequestToken:null,nextPastToken:e&&e.direction!==d.FetchDirection.Past?null:n.nextRequestToken});0;return r})})};t.prototype._fetchActivitiesOnSpecificDate=function(e){var t=this,r=this.props.restoreActivitiesDataSource;0;var s=c.dateFromLocalTimezoneDate(e);s.setDate(s.getDate()+1);this.setState({isLoadingActivities:!0});return i.default.all({futureResponse:r.getActivitiesOnSpecificDate({headers:h.getCVHeader(h.getCVValue(this._mscvBase)),sortAscending:!0,startDateTime:s}),pastResponse:r.getActivitiesOnSpecificDate({headers:h.getCVHeader(h.getCVValue(this._mscvBase)),startDateTime:s})}).then(function(r){var i=r.futureResponse,s=r.pastResponse;0;t.setState(function(t){console.log("_fetchActivitiesOnSpecificDate(date: "+e+"): prevState",t);var r=w(t,{isPlaceholder:!1,activities:n.__spreadArrays(n.__spreadArrays(i.activities).reverse(),s.activities),success:!0},{nextFutureToken:i.nextRequestToken,nextPastToken:s.nextRequestToken});console.log("_fetchActivitiesOnSpecificDate(date: "+e+"): stateUpdate",r);return r})})};t.prototype._fetchActivitiesByDate=function(){var e=this,t=this.props.restoreActivitiesDataSource;this.setState({isLoadingActivitiesCountByDate:!0});var r=c.dateNDaysAgo(29),i=c.localTimezoneDate(r);return t.getActivitiesByDate({headers:h.getCVHeader(h.getCVValue(this._mscvBase)),startDateTime:r}).then(function(t){e.setState({activitiesCountByDate:n.__assign(n.__assign({},t),{activitiesByDate:t.activitiesByDate.filter(function(e){return e.date>=i})}),isLoadingActivitiesCountByDate:!1})})};t.prototype._fetchPointsOfInterest=function(){var e=this,t=this.props.restoreActivitiesDataSource,n={headers:h.getCVHeader(h.getCVValue(this._mscvBase))};t.getPointsOfInterest(n,c.dateNDaysAgo(30)).then(function(t){var n=e._getSuggestedPointOfInterest(t),r=[],i=o.createFastMap();if(n){i.set(n.id,n);r.push(n)}for(var s=0,u=t;s<u.length;s++){var a=u[s];if(!i.has(a.id)){i.set(a.id,a);r.push(a)}}e.setState({pointsOfInterest:r})},function(t){e.setState({pointsOfInterestError:t})})};t.prototype._getSuggestedPointOfInterest=function(e){var t=this.props.navigation,n=this.state.anomaly;if(t.viewParams.suggestedRestoreDate){for(var r=new Date(t.viewParams.suggestedRestoreDate),i=0,s=e;i<s.length;i++){var o=s[i];if(Math.abs(r.getTime()-o.time.getTime())<1e3)return o}return{id:"suggestedRestoreDate",time:r,isPointInTimeRestore:!1,isRansomware:!1}}if(n&&(0===n.state||1===n.state||2===n.state))for(var u=0,a=e;u<a.length;u++){if((o=a[u]).isRansomware)return o}};t.prototype._submitRestore=function(e,t){var n=this,r=this.props.resources,s=this.state,o=s.activitiesWithPlaceholders,u=s.anomaly;return new i.default(function(i,s){for(var f,l=0,c=o.activities;l<c.length;l++){var p=c[l];if(d.isActivity(p)){f=p;break}}new(r.injected(a.default))({anomalyId:u&&u.id,headers:h.getCVHeader(h.getCVValue(n._mscvBase)),restoreToDateTime:t,mostRecentActivityId:f&&f.id,onResolve:i,onReject:s}).execute(e)})};return t})(s.Component);t.default=v;function m(e){return e.percentComplete>=100||e.status===f.RestoreStatus.Cancelled||e.status===f.RestoreStatus.CancelPending||e.status===f.RestoreStatus.Completed||e.status===f.RestoreStatus.Failed}function g(e,t){for(var n=0,r=0,i=[];n<e.length||r<t.length;){var s=e[n],o=t[r];if(n>=e.length){i.push(o);r+=1}else if(r>=t.length){i.push(s);n+=1}else if(s.id===o.id){i.push(s);n+=1;r+=1}else if(s.time>o.time){i.push(s);n+=1}else{i.push(o);r+=1}}return i}t.mergeActivities=g;function y(e,t,n){for(var r=[],i=0,s=e;i<s.length;i++){var o=s[i],u=t.hasOwnProperty(o.id);u&&r.push({direction:d.FetchDirection.Future,token:t[o.id]});r.push(o);!u&&n.hasOwnProperty(o.id)&&r.push({direction:d.FetchDirection.Past,token:n[o.id]})}return r}t.insertPlaceholders=y;function b(e,t,n){if(0===e.length)throw new Error("The activities list must not be empty");for(var r={fetchTokensFuture:{},fetchTokensPast:{}},i=0,s=e.length;i<s;i++){var o=i>0?e[i-1]:void 0,u=e[i],a=i<s-1?e[i+1]:void 0;!n[u.id]||a&&!t[a.id]||(r.fetchTokensPast[u.id]=n[u.id]);!t[u.id]||o&&!n[o.id]||(r.fetchTokensFuture[u.id]=t[u.id])}return r}t.pruneInvalidFetchTokens=b;function w(e,t,r){var i,s;if(t.error)return n.__assign(n.__assign({},e),{activities:n.__assign(n.__assign({},e.activities),{error:t.error,success:t.success}),activitiesWithPlaceholders:n.__assign(n.__assign({},e.activitiesWithPlaceholders),{error:t.error}),isLoadingActivities:!1,isLoadingInitialActivities:!1});var o=e.activitiesFetchTokensFuture,u=e.activitiesFetchTokensPast,a=e.activities.activities,f=t.activities;if(0===f.length)return n.__assign(n.__assign({},e),{isLoadingActivities:!1,isLoadingInitialActivities:!1});var l=g(a,f),c=r.nextFutureToken?((i={})[f[0].id]=r.nextFutureToken,i):{},h=r.nextPastToken?((s={})[f[f.length-1].id]=r.nextPastToken,s):{},p=b(l,n.__assign(n.__assign({},o),c),n.__assign(n.__assign({},u),h)),d=p.fetchTokensFuture,v=p.fetchTokensPast;return n.__assign(n.__assign({},e),{activities:n.__assign(n.__assign({},t),{activities:l}),activitiesWithPlaceholders:n.__assign(n.__assign({},e.activitiesWithPlaceholders),{activities:y(l,d,v)}),activitiesFetchTokensFuture:d,activitiesFetchTokensPast:v,isLoadingActivities:!1,isLoadingInitialActivities:!1})}t.updateActivities=w});
define("h9t",["require","exports","ww","Tu","r"],function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.render=function(){var e=this.props,t=e.children,n=e.header,s=e.restorePageTitle,o=e.isFluent;return i.createElement(r.Fabric,null,i.createElement("div",{className:"od-Restore"},i.createElement("div",{className:"od-Restore-header"},i.createElement("h2",{className:"od-Restore-title"},s),!o&&n),!o&&t,o&&i.createElement("div",{className:"od-Restore-body"},i.createElement("div",null,n),i.createElement("div",null,t))))};return t})(i.Component);t.default=s});
define("u9t",["require","exports","ww","Jv","tB","tg","SK","k3","v","r","sB","bQ","dv","pO","T2","LO","O3","f9t"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.componentResourceKey=void 0;var y=(function(e){n.__extends(t,e);function t(t,n){var r=e.call(this,t)||this,s=n.dependencies.resources;r._observables=new(s.consume(i.observablesFactoryTypeResourceKey))({owner:r});s.expose(v.itemsSelection,null);return r}t.prototype.render=function(){var e=this.context.dependencies,t=e.bundleLoader,n=e.engagement,r=e.navigation,i=e.platformDetection,s=e.ransomwareDetectionProvider,o=e.resources,u=e.restoreActivitiesDataSource,a=e.restoreOperationProgressProvider,l=e.urlDataSource,c=e.vaultDataSource,p=e.actionMap,d=e.isFluent;return f.createElement(g.default,{bundleLoader:t,engagement:n,isWebViewHosted:h.isWebViewHosted(),observables:this._observables,ransomwareDetectionProvider:s,resources:o,restoreActivitiesDataSource:u,restoreOperationProgressProvider:a,navigation:r,platformDetection:i,urlDataSource:l,vaultDataSource:c,actionMap:p,isFluent:d})};t.contextTypes={dependencies:r.object.isRequired};return t})(f.Component);t.default=y;t.componentResourceKey=o.createResolvedComponentTypeResourceKey(e("module").id,y,{actionMap:v.actionMap,bundleLoader:d.bundleLoader,engagement:l.resourceKey,navigation:s.navigation,platformDetection:u.platformDetection,ransomwareDetectionProvider:d.ransomwareDetection,resources:a.resourceScopeKey.local,restoreActivitiesDataSource:p.restoreActivities,restoreOperationProgressProvider:c.resourceKey,urlDataSource:p.url,vaultDataSource:p.vault.optional,isFluent:m.resourceKey})});
define("O9t",["require","exports","v"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.componentResourceKey=void 0;t.componentResourceKey=new n.ResourceKey({name:e("module").id,loader:new n.AliasResourceLoader(function(){return new Promise(function(t,n){e(["u9t"],t,n)}).then(function(e){return e.componentResourceKey.local})})})});
define("b9t",["require","exports","ww","ou","r","h9t"],function(e,t,n,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.render=function(){var e=this.props,t=e.children,n=e.isLoading,o=e.restorePageTitle,u=e.title,a=e.isRestoreComplete,f=e.isFluent,l=a?window.require.toUrl("@ms/odsp-media/lib/images/restore/restorecomplete.svg"):window.require.toUrl("@ms/odsp-media/lib/images/restore/restore.svg");return i.createElement(s.default,{isFluent:f,restorePageTitle:o},i.createElement("div",{className:"od-Restore-status"},n?i.createElement(r.Spinner,{size:r.SpinnerSize.large}):i.createElement(i.Fragment,null,i.createElement("img",{className:"od-Restore-status-image",src:l,alt:""}),i.createElement("h2",{className:"od-Restore-status-title"},u),t)))};return t})(i.Component);t.default=o});
define("n3t",["require","exports","uc","pc"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TopAnchoredRangeSelection=void 0;var i=(function(){function e(e){var t=this;void 0===e&&(e={});this.mode=n.SelectionMode.multiple;this._onItemsChanged=e.onItemsChanged;this._selection=new n.Selection({onSelectionChanged:function(){r.EventGroup.raise(t,n.SELECTION_CHANGE);e.onSelectionChanged&&e.onSelectionChanged()}})}e.prototype.toggleIndexSelected=function(e){this.isIndexLastInSelectedRange(e)?this._selection.setIndexSelected(e,!1,!1):this._setRangeSelected(0,e)};e.prototype.toggleRangeSelected=function(e,t){this.isRangeSelected(e,t)?0!==e?this.toggleIndexSelected(e-1):this.setAllSelected(!1):this.toggleIndexSelected(e+t-1)};Object.defineProperty(e.prototype,"count",{get:function(){return this._selection.count},enumerable:!1,configurable:!0});e.prototype.canSelectItem=function(e){return this._selection.canSelectItem(e)};e.prototype.setChangeEvents=function(e,t){return this._selection.setChangeEvents(e,t)};e.prototype.setItems=function(e,t){var n=this._selection.setItems(e,t);this._onItemsChanged&&this._onItemsChanged();return n};e.prototype.getItems=function(){return this._selection.getItems()};e.prototype.getSelection=function(){return this._selection.getSelection()};e.prototype.getSelectedIndices=function(){return this._selection.getSelectedIndices()};e.prototype.getSelectedCount=function(){return this._selection.getSelectedCount()};e.prototype.isRangeSelected=function(e,t){return this._selection.isRangeSelected(e,t)};e.prototype.isAllSelected=function(){return this._selection.isAllSelected()};e.prototype.isKeySelected=function(e){return this._selection.isKeySelected(e)};e.prototype.isIndexSelected=function(e){return this._selection.isIndexSelected(e)};e.prototype.setAllSelected=function(e){return this._selection.setAllSelected(e)};e.prototype.setKeySelected=function(e,t,n){return this._selection.setKeySelected(e,t,n)};e.prototype.setIndexSelected=function(e,t,n){return this._selection.setIndexSelected(e,t,n)};e.prototype.selectToKey=function(e,t){return this._selection.selectToKey(e,t)};e.prototype.selectToIndex=function(e,t){return this._selection.selectToIndex(e,t)};e.prototype.toggleAllSelected=function(){return this._selection.toggleAllSelected()};e.prototype.toggleKeySelected=function(e){return this._selection.toggleKeySelected(e)};e.prototype.isIndexLastInSelectedRange=function(e){return this.getSelectedCount()===e+1};e.prototype._setRangeSelected=function(e,t){this._selection.setIndexSelected(0,!0,!0);this._selection.selectToIndex(t,!0)};return e})();t.TopAnchoredRangeSelection=i});
define("t3t",["require","exports","ww","r","n3t"],function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n._handleItemsChanged=function(){n._updateSelectionModel()};n._handleSelectionChanged=function(){var e=n.props.onSelectItem;if(n._ignoreChangeCount>0)n._ignoreChangeCount-=1;else{var t=n._selection.getSelectedCount();e(n._selection.getItems()[t-1],t)}};n._ignoreChangeCount=0;n._selection=new i.TopAnchoredRangeSelection({onItemsChanged:n._handleItemsChanged,onSelectionChanged:n._handleSelectionChanged});return n}t.prototype.componentDidMount=function(){this._updateSelectionModel()};t.prototype.componentDidUpdate=function(e){this.props.selectedItem!==e.selectedItem&&this._updateSelectionModel()};t.prototype.render=function(){return this.props.render(this._selection)};t.prototype._updateSelectionModel=function(){var e=this.props,t=e.getKey,n=e.selectedItem;if(n){for(var r=this._selection.getItems(),i=t(n),s=0;s<r.length;s++)if(t(r[s])===i){if(!this._selection.isIndexLastInSelectedRange(s)){this._ignoreChangeCount+=1;this._selection.setChangeEvents(!1);this._selection.toggleIndexSelected(s);this._selection.setChangeEvents(!0)}return}}else if(this._selection.getSelectedCount()>0){this._ignoreChangeCount+=1;this._selection.setChangeEvents(!1);this._selection.setAllSelected(!1);this._selection.setChangeEvents(!0)}};return t})(r.Component);t.default=s});
define("a3t",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DatePreset=t.isPlaceholder=t.isActivity=t.FetchDirection=void 0;(function(e){e[e.Future=0]="Future";e[e.Past=1]="Past"})(t.FetchDirection||(t.FetchDirection={}));t.isActivity=function(e){return!n(e)};function n(e){return void 0!==e.token}t.isPlaceholder=n;(function(e){e.Yesterday="Yesterday";e.OneWeekAgo="OneWeekAgo";e.ThreeWeeksAgo="ThreeWeeksAgo";e.Custom="Custom"})(t.DatePreset||(t.DatePreset={}))});
define("hQ",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.extname=t.countHoursAgo=t.countDaysAgo=t.datesForLastNDays=t.dateNDaysAgo=t.dateFromLocalTimezoneDate=t.utcDate=t.localTimezoneDate=void 0;function n(e){return e<10?"0"+e:e}function r(e){return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())}t.localTimezoneDate=r;t.utcDate=function(e){return e.getUTCFullYear()+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())};t.dateFromLocalTimezoneDate=function(e){var t=new Date(e),n=t.getUTCFullYear(),r=t.getUTCMonth(),i=t.getUTCDate();return new Date(n,r,i)};function i(e){var t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate()-e)}t.dateNDaysAgo=i;t.datesForLastNDays=function(e){for(var t=[],n=0;n<e;n++)t.push({daysAgo:n,date:r(i(n))});return t};t.countDaysAgo=function(e){var t=r(new Date);return(new Date(t).getTime()-new Date(e).getTime())/864e5};t.countHoursAgo=function(e){var t=(new Date).getTime()-e.getTime();return Math.floor(t/36e5)};t.extname=function(e){return e.replace(/^.*\./,"")}});
define("_9t",["require","exports","ww","r","h9t","i3t","Zm","ODBRestore_mini_css"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.render=function(){var e=this.props,t=e.restorePageTitle,n=e.onVaultVerify,u=e.isFluent,a=window.require.toUrl("odsp-media/images/vault/restore-vault-verify.svg");return r.createElement(i.default,{restorePageTitle:t,isFluent:u},r.createElement("div",{className:"od-restore-vaultVerification-page"},r.createElement("img",{className:"od-Restore-vaultVerification-image",src:a,alt:s.default.vaultVerify}),r.createElement("h2",{className:"od-Restore-vaultVerification-title"},s.default.verifyIdentityHeading),r.createElement("div",null,s.default.verifyIdentityBody),r.createElement(o.PrimaryButton,{text:s.default.verifyYourIdentity,onClick:n})))};return t})(r.Component);t.default=u});
define("Hq",["require","exports","aQ","A","v","Eq","pO","eQ","jq","Bq","fB","bw","Nq","Rq","cc","Gi","Je","Qi","g"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.resourceKey=t.RestoreOperationDataSource=void 0;var b=m.default.isActivated("5ac77fd7-fd39-42ce-aac8-70fab8218fa1","8/26/2020","Consume isReadOnlyUI value to avoid Operations API call"),w=m.default.isActivated("FBF5BF4F-D10F-45FF-9990-16200C8F7C21","10/27/2020","Require a default list URL to perform Restore operations"),E=(function(){function e(e,t){this._authTokenFetcher=t.authTokenFetcher;this._dataRequestor=t.vroomDataRequestor;this._graphDataSource=t.graphDataSource;this._itemsStore=t.itemsStore;this._urlDataSource=t.urlDataSource;this._pageContext=t.pageContext;this._isItemsScopeEnabled=t.isItemsScopeEnabled;this._itemCacheStore=t.itemCacheStore;this._itemsScopeCurrentItemKey=t.itemsScopeCurrentItemKey}e.prototype.getOngoingRestoreOperation=function(e){var t=this,i=e||{},s=i.skipCache,o=i.url;return!s&&!1===this._getIsReadOnlyUI()||!w&&!this._pageContext.listUrl?r.default.resolve(void 0):(o?r.default.resolve(o):this._getRootDriveItemUrl("v2.1").then(function(i){var s=i.url,o=i.sessionToken;return t._dataRequestor.send({apiName:t.getQosPrefix()+".Operations",apiVersion:"v2.1",headers:e&&e.headers,path:s+"/operations",accessToken:o}).then(function(e){return e.value.filter(function(e){return"DocumentLibraryRestore"===e.type})},function(e){return n.isGraphError(e)&&404===e.status?[]:r.default.reject(e)}).then(function(e){return 0===e.length?null:s+"/operations/"+e[0].id})})).then(function(e){if(e)return t._getRestoreOperation(e)})};e.prototype.submitRestore=function(e){var t=this;return w||this._pageContext.listUrl?this._getRootDriveItemUrl("v2.1").then(function(n){var r=n.url,i=n.sessionToken;return t._dataRequestor.send({apiName:t.getQosPrefix()+".RestoreToDate",apiVersion:"v2.1",requestType:"POST",headers:e.headers,path:r+"/oneDrive.restoreToDate",accessToken:i,postData:JSON.stringify({restoreTo:e.dateTime,mostRecentActivityId:e.mostRecentActivityId})})}):r.default.reject(new Error("No list available to perform Restore operation"))};e.prototype.isOneDrive=function(){return l.isOneDrive};e.prototype.getQosPrefix=function(){return(this.isOneDrive()?"OneDrive":"TeamSiteDocLib")+".Restore"};e.prototype._getRestoreOperation=function(e,t){return this._dataRequestor.send({apiName:this.getQosPrefix()+".RestoreStatus",apiVersion:"v2.1",path:e}).then(function(t){return{percentComplete:t.percentComplete,status:{cancelled:f.RestoreStatus.Cancelled,cancelpending:f.RestoreStatus.CancelPending,completed:f.RestoreStatus.Completed,failed:f.RestoreStatus.Failed,notstarted:f.RestoreStatus.NotStarted,inprogress:f.RestoreStatus.InProgress,aborted:f.RestoreStatus.Cancelled,aborting:f.RestoreStatus.CancelPending,running:f.RestoreStatus.InProgress,unknown:f.RestoreStatus.Unknown}[t.status.toLowerCase()],url:e}})};e.prototype._getRootDriveItemUrl=function(e){var t=this,n=this._urlDataSource.getRootItemKey();return this._authTokenFetcher.ensureAuthToken(n).then(function(){return t._itemsStore.getItem(n)()}).then(function(n){return{url:t._graphDataSource.getDriveUrl(n,{apiVersion:e,useDirectEndpoint:!0}),sessionToken:t._graphDataSource.getAccessToken(n,{apiVersion:e,useDirectEndpoint:!0})}})};e.prototype._getIsReadOnlyUI=function(){var e,t=this;!b&&this._isItemsScopeEnabled&&this._itemCacheStore&&this._itemsScopeCurrentItemKey&&(e=this._itemCacheStore.dispatch(d.readItems(function(e){var n=e.demandItemFacet(g.spFolderItemSetKeyFacet,t._itemsScopeCurrentItemKey&&t._itemsScopeCurrentItemKey.peek());if(n){var r=g.spListKeyFacet.serialize({webAbsoluteUrl:n.webAbsoluteUrl,listFullUrl:n.listFullUrl});return e.demandItemFacet(v.isReadOnlyUIFacet,r)}})));return e};e.dependencies={authTokenFetcher:a.resourceKey,isItemsScopeEnabled:p.isItemsScopeEnabledResourceKey,itemCacheStore:c.resourceKey.optional,itemsScopeCurrentItemKey:h.resourceKey.optional,pageContext:y.pageContext,graphDataSource:o.graph,itemsStore:s.resourceKey,urlDataSource:o.url,vroomDataRequestor:u.resourceKey};return e})();t.RestoreOperationDataSource=E;t.resourceKey=i.createResolvedResourceKey(e("module").id,E)});
define("sQ",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RestoreDisabledErrorCode=void 0;(function(e){e[e.VersioningDisabled=0]="VersioningDisabled";e[e.ForceCheckoutEnabled=1]="ForceCheckoutEnabled";e[e.VersioningDisabledAndForceCheckoutEnabled=2]="VersioningDisabledAndForceCheckoutEnabled"})(t.RestoreDisabledErrorCode||(t.RestoreDisabledErrorCode={}))});
define("iQ",["require","exports","ww","A","v","hQ","Eq","pO","eQ","cQ","jq","sQ","oQ","g","rQ"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.resourceKey=void 0;var v=(function(){function e(e,t){void 0===e&&(e={});this._authTokenFetcher=t.authTokenFetcher;this._dataRequestor=t.vroomDataRequestor;this._graphDataSource=t.graphDataSource;this._itemActivitiesService=t.itemActivitiesService;this._itemsStore=t.itemsStore;this._urlDataSource=t.urlDataSource;this._pageContext=t.pageContext}e.prototype.getActivities=function(e){var t=this;return this._getRootDriveItem("v2.0").then(function(n){return t._itemActivitiesService.getItemActivities({environment:"sharePoint",orderBy:"time "+(e.sortAscending?"asc":"desc"),headers:e.headers,item:n,pageSize:25,nextRequestToken:e.nextRequestToken,filter:"showHidden eq 'true'",qosPrefix:t.getQosPrefix()})})};e.prototype.getActivitiesByDate=function(e){var t=this;return this._getRootDriveItem("v2.0").then(function(n){return t._dataRequestor.send({apiName:t.getQosPrefix()+".ActivityCounts",headers:e.headers,path:n.graphItemUrl+"/activityCounts?$filter=starttime eq datetime'"+s.dateNDaysAgo(30).toISOString()+"'"}).then(function(e){return{activitiesByDate:h.groupByDate(e.value),success:!0}})})};e.prototype.getActivityOffsetFromDateTime=function(e){return r.default.resolve(0)};e.prototype.getActivitiesOnSpecificDate=function(e){var t=this;return this._getRootDriveItem("v2.0").then(function(n){return t._itemActivitiesService.getItemActivities({environment:"sharePoint",filter:"showHidden eq 'true' and "+(e.sortAscending?"starttime":"endtime")+" eq datetime'"+e.startDateTime.toISOString()+"'",orderBy:"time "+(e.sortAscending?"asc":"desc"),headers:e.headers,item:n,pageSize:25,qosPrefix:t.getQosPrefix()})})};e.prototype.getPointsOfInterest=function(){return r.default.resolve([])};e.prototype.getLibraryTitle=function(){return this.isOneDrive()?d.default.yourOneDrive:this._pageContext.listTitle};e.prototype.getCombinedSiteLibraryTitle=function(){return this.isOneDrive()?d.default.yourOneDrive:this._pageContext.webTitle+" - "+this._pageContext.listTitle};e.prototype.isOneDrive=function(){return!this._pageContext||"21"===this._pageContext.webTemplate};e.prototype.getQosPrefix=function(){return this.getScenarioName()+".Restore"};e.prototype.getScenarioName=function(){return this.isOneDrive()?"OneDrive":"TeamSiteDocLib"};e.prototype.isPremiumUser=function(){return r.default.resolve(!0)};e.prototype.isEligibleForFreemium=function(){return this.isPremiumUser()};e.prototype.getRestoreEligibility=function(){return r.default.resolve(1)};e.prototype.isRestoreSupported=function(){var e=this;return this.isOneDrive()?r.default.resolve({isRestoreSupported:!0}):this._getRootDriveItem("v2.0").then(function(t){return e._dataRequestor.send({apiName:e.getQosPrefix()+".GetSubscriptions",apiVersion:"v2.0",requestType:"GET",useAuthorizationHeaders:!0,path:t.graphItemUrl+"/commands"})}).then(function(t){if(!t)return{isRestoreSupported:!0};var r;r=t.enableVersioning?t.forceCheckOut?{isRestoreSupported:!1,errorCode:c.RestoreDisabledErrorCode.ForceCheckoutEnabled}:{isRestoreSupported:!0}:t.forceCheckOut?{isRestoreSupported:!1,errorCode:c.RestoreDisabledErrorCode.VersioningDisabledAndForceCheckoutEnabled}:{isRestoreSupported:!1,errorCode:c.RestoreDisabledErrorCode.VersioningDisabled};return n.__assign(n.__assign({},r),{versionSettingsLink:e._getVersionSettingsUrl()})})};e.prototype._getVersionSettingsUrl=function(){return this._pageContext.webAbsoluteUrl+"/_layouts/15/LstSetng.aspx?List="+encodeURIComponent(this._pageContext.listId)};e.prototype._getRootDriveItem=function(e){var t=this,n=this._urlDataSource.getRootItemKey();return this._authTokenFetcher.ensureAuthToken(n).then(function(){return t._itemsStore.getItem(n)()}).then(function(n){return{name:"",graphItemUrl:t._graphDataSource.getDriveUrl(n,{apiVersion:e,useDirectEndpoint:!0})}})};e.dependencies={authTokenFetcher:l.resourceKey,vroomDataRequestor:a.resourceKey,graphDataSource:u.graph,itemActivitiesService:f.itemActivitiesServiceKey,itemsStore:o.resourceKey,urlDataSource:u.url,pageContext:p.pageContext};return e})();t.default=v;t.resourceKey=i.createResolvedResourceKey(e("module").id,v)});
define("oQ",["require","exports","Vi","hQ"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.groupByDate=void 0;t.groupByDate=function(e,t){void 0===t&&(t=r.localTimezoneDate);for(var i=n.createFastMap(),s=[],o=0,u=e;o<u.length;o++){var a=u[o],f=t(new Date(a.startDateTime)),l=i.get(f);if(!l){l={date:f,totalCount:0};i.set(f,l);s.push(l)}l.totalCount+=a.totalCount.actionCount}s.sort(function(e,t){var n=e.date,r=t.date;return n>r?-1:n<r?1:0});return s}});
define("x9t",["require","exports","w9t","C9t","hz"],function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i.registerComponent({tagName:"od-restore",template:n.default,viewModel:r.default,synchronous:!0});t.default=s});
define("w9t",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default='\x3c!--ko component:{name:transclusionContentTagName,params:commandBarTransclusionContentParams}--\x3e<div data-bind="control:commandBarSpecification"></div>\x3c!--/ko--\x3e<div data-bind="react:{componentType:restorePageComponent,props:restorePageProps}"></div>'});
define("C9t",["require","exports","ww","SK","t0t","Rz","fB","pO","LO","g","cge","O9t","Mz","lte","EW"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){n.__extends(t,e);function t(t,n){var i=e.call(this,t,n)||this;if(i.resources.isExposed(f.pageContext)){var l=i.resources.consume(f.pageContext),h=i.resources.consume(u.url);if(!l.isSiteAdmin){var p=i.resources.consume(a.actionMap);new(i.managed(p.NavigationAction))({url:h.getRootUrl(),target:"_blank"}).execute({})}}var v=o.isFeatureEnabled(o.ShowLeftNavOnRestorePage);i.isTopBarVisible(v);i.addBindingHandlers({react:s.default});i.restorePageComponent=r.ResourcedControl;i.restorePageProps=i.observables.pureCompute(function(){return{resources:i.resources,specification:r.toSpecification(c.componentResourceKey.local,{})}});i.transclusionContentTagName=d.default.tagName;i.commandBarSpecification=i._getCommandBarSpecification();return i}t.prototype._getCommandBarSpecification=function(){var e={commands:this.observables.createArray([new(this.managed(l.default))({renderLabel:2}).command])};return h.toSpecification(p.resourceKey,{commandSet:e})};return t})(i.default);t.default=v});
define("d3t",["require","exports","M"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getCVHeader=t.getCVValue=t.getCVBase=t.getGuid=void 0;var r,i={};function s(){r||(r=n.default.generate());return r}t.getGuid=s;t.getCVBase=function(){var e=s();return""+btoa(e.match(/\w{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join("")).replace(/=/g,"").replace(/[+]/g,"-").replace(/\//g,"_")};t.getCVValue=function(e){var t;t=i[e]||0===i[e]?i[e]+1:0;i[e]=t;return e+"."+t};t.getCVHeader=function(e){return{"ms-cv":e}}});
define('ODBRestore_mini_css',["nt","Ew"],function(e){"use strict";e.loadStyles([{"rawString":"[dir=ltr] .od-BasePage-leftNavVisible.od-Restore .od-BasePage-leftNav{left:0}[dir=rtl] .od-BasePage-leftNavVisible.od-Restore .od-BasePage-leftNav{right:0}[dir=ltr] .od-BasePage-leftNavVisible.od-Restore .od-BasePage-leftNav{animation-name:ms-fadeIn,ms-slideRightIn40;animation-duration:367ms;animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-fill-mode:both}@media (prefers-reduced-motion:reduce){[dir=ltr] .od-BasePage-leftNavVisible.od-Restore .od-BasePage-leftNav{animation:none}}[dir=rtl] .od-BasePage-leftNavVisible.od-Restore .od-BasePage-leftNav{animation-name:ms-fadeIn,ms-slideLeftIn40;animation-duration:367ms;animation-timing-function:cubic-bezier(.1,.9,.2,1);animation-fill-mode:both}@media (prefers-reduced-motion:reduce){[dir=rtl] .od-BasePage-leftNavVisible.od-Restore .od-BasePage-leftNav{animation:none}}[dir=ltr] .od-BasePage-leftNavClosing .od-BasePage-leftNav{left:0}[dir=rtl] .od-BasePage-leftNavClosing .od-BasePage-leftNav{right:0}[dir=ltr] .od-BasePage-leftNavClosing .od-BasePage-leftNav{animation-name:ms-fadeOut,ms-slideLeftOut40;animation-duration:167ms;animation-timing-function:cubic-bezier(.1,.25,.75,.9);animation-fill-mode:both}@media (prefers-reduced-motion:reduce){[dir=ltr] .od-BasePage-leftNavClosing .od-BasePage-leftNav{animation:none}}[dir=rtl] .od-BasePage-leftNavClosing .od-BasePage-leftNav{animation-name:ms-fadeOut,ms-slideRightOut40;animation-duration:167ms;animation-timing-function:cubic-bezier(.1,.25,.75,.9);animation-fill-mode:both}@media (prefers-reduced-motion:reduce){[dir=rtl] .od-BasePage-leftNavClosing .od-BasePage-leftNav{animation:none}}[dir=ltr] .xlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content,[dir=ltr] .xxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content,[dir=ltr] .xxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content,[dir=ltr] .xxxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{left:208px}[dir=rtl] .xlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content,[dir=rtl] .xxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content,[dir=rtl] .xxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content,[dir=rtl] .xxxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{right:208px}[dir=ltr] .isFluent.xlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{left:228px}[dir=rtl] .isFluent.xlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{right:228px}[dir=ltr] .isFluent.xxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{left:228px}[dir=rtl] .isFluent.xxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{right:228px}[dir=ltr] .isFluent.xxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{left:228px}[dir=rtl] .isFluent.xxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{right:228px}[dir=ltr] .isFluent.xxxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{left:228px}[dir=rtl] .isFluent.xxxxlg .od-BasePage-leftNavVisible.od-Restore .od-BasePage-content{right:228px}.od-Restore{min-height:100%;padding:0 32px;box-sizing:border-box}.isFluent.sm .od-Restore{padding:0 16px}.isFluent.md .od-Restore{padding:0 16px}.isFluent.lg .od-Restore{padding:0 16px}.od-Restore-details{min-width:320px;max-width:960px}.od-Restore-error{color:"},{"theme":"redDark","defaultValue":"#a4262c"},{"rawString":"}.od-Restore-header{box-sizing:border-box;margin-bottom:0}.od-Restore-header .od-Restore-title{text-overflow:ellipsis;color:"},{"theme":"neutralDark","defaultValue":"#201f1e"},{"rawString":";font-size:21px;font-weight:100}.isFluent .od-Restore-header .od-Restore-title{margin-bottom:26px;font-size:20px;font-weight:600}.xlg .od-Restore-header .od-Restore-title,.xxlg .od-Restore-header .od-Restore-title,.xxxlg .od-Restore-header .od-Restore-title,.xxxxlg .od-Restore-header .od-Restore-title{font-size:28px;font-weight:100}.isFluent.xlg .od-Restore-header .od-Restore-title{font-size:20px;font-weight:600}.isFluent.xxlg .od-Restore-header .od-Restore-title{font-size:20px;font-weight:600}.isFluent.xxxlg .od-Restore-header .od-Restore-title{font-size:20px;font-weight:600}.isFluent.xxxxlg .od-Restore-header .od-Restore-title{font-size:20px;font-weight:600}.od-Restore-header .od-Restore-description{max-width:640px;margin-bottom:12px;color:"},{"theme":"neutralSecondary","defaultValue":"#605e5c"},{"rawString":";font-size:14px;font-weight:400}.isFluent .od-Restore-description{color:"},{"theme":"neutralSecondary","defaultValue":"#605e5c"},{"rawString":"}.od-Restore-body{padding:18px 24px 24px;box-shadow:0 1.6px 3.6px 0 rgba(0,0,0,.132),0 .3px .9px 0 rgba(0,0,0,.108)}.xxxxlg .od-Restore-body{max-width:1124px}.xxxlg .od-Restore-body{max-width:1080px}.xxlg .od-Restore-body{max-width:800px}.xlg .od-Restore-body{max-width:732px}.sm .od-Restore-body{padding:16px}.od-Restore-bodyTitle{display:none;font-size:16px;font-weight:600;margin-bottom:12px}.isFluent .od-Restore-bodyTitle{display:block}.od-Restore-presets{display:flex;align-items:flex-end;margin-bottom:20px}.isFluent .od-Restore-presets{margin-top:16px;margin-bottom:24px;flex-direction:column;align-items:flex-start}.od-Restore-presets .ms-Dropdown-container{flex:1;max-width:400px}.isFluent .od-Restore-presets .ms-Dropdown-container{flex:inherit;width:100%}.od-Restore-presets .od-Restore-presets-dropdown{margin:0}.od-Restore-presets .od-Restore-target-hint{height:32px;display:flex;align-items:center;color:"},{"theme":"bodySubtext","defaultValue":"#605e5c"},{"rawString":"}html[dir=ltr] .od-Restore-presets .od-Restore-target-hint{margin-left:20px}html[dir=rtl] .od-Restore-presets .od-Restore-target-hint{margin-right:20px}html[dir=ltr] .isFluent .od-Restore-presets .od-Restore-target-hint{margin-left:0}html[dir=rtl] .isFluent .od-Restore-presets .od-Restore-target-hint{margin-right:0}.od-Restore-actions{display:flex}html[dir=ltr] .od-Restore-actions .od-Restore-exit-button{margin-left:16px}html[dir=rtl] .od-Restore-actions .od-Restore-exit-button{margin-right:16px}.od-Restore-customPreset-description{margin-top:32px;margin-bottom:8px;color:"},{"theme":"bodyText","defaultValue":"#323130"},{"rawString":";font-size:14px;font-weight:400}.od-Restore-datetime-selector-slider-container{padding:0 16px}.od-Restore-datetime-selector-slider-container .od-Restore-datetime-selector-slider .ms-Slider-thumb{width:32px}.od-Restore-list-container{position:relative;height:800px;min-width:640px}.od-Restore-list-container .ms-DetailsList:hover .ms-DetailsRow,.od-Restore-list-container .ms-DetailsList:hover .ms-GroupHeader{background:"},{"theme":"listItemBackgroundHovered","defaultValue":"#f3f2f1"},{"rawString":";color:"},{"theme":"neutralSecondary","defaultValue":"#605e5c"},{"rawString":"}.od-Restore-list-container .ms-DetailsList:hover .ms-DetailsRow-check{opacity:1}.od-Restore-list-container .ms-DetailsList:hover .ms-List-cell:hover~.ms-List-cell .ms-DetailsRow,.od-Restore-list-container .ms-DetailsList:hover .ms-List-cell:hover~.ms-List-cell .ms-GroupHeader,.od-Restore-list-container .ms-DetailsList:hover .ms-List-page:hover~.ms-List-page .ms-DetailsRow,.od-Restore-list-container .ms-DetailsList:hover .ms-List-page:hover~.ms-List-page .ms-GroupHeader{background:"},{"theme":"listBackground","defaultValue":"#ffffff"},{"rawString":";color:"},{"theme":"neutralSecondaryAlt","defaultValue":"#8a8886"},{"rawString":"}.od-Restore-list-container .ms-DetailsList:hover .ms-List-cell:hover~.ms-List-cell .ms-Check:not(.is-checked),.od-Restore-list-container .ms-DetailsList:hover .ms-List-page:hover~.ms-List-page .ms-Check:not(.is-checked){opacity:0}.od-Restore-list-container .ms-DetailsHeader-cellIsCheck{visibility:hidden}.od-Restore-list-container .ms-GroupHeader-check{visibility:hidden}.od-Restore-list-container .ms-GroupHeader-title{cursor:auto}html[dir=ltr] .od-Restore-list-container .ms-GroupHeader-title{padding-left:16px}html[dir=rtl] .od-Restore-list-container .ms-GroupHeader-title{padding-right:16px}.od-Restore-list-container .od-Restore-list-icon-cell{padding:11px 0 11px 8px}html[dir=rtl] .od-Restore-list-container .od-Restore-list-icon-cell{padding:11px 8px 11px 0}.od-Restore-list-container .ms-Icon{font-size:16px}.od-Restore-list-container .od-Restore-list-change-cell{max-width:80px}.od-Restore-status{text-align:center;padding-top:48px}.od-Restore-status .od-Restore-status-error{margin-bottom:16px}.od-Restore-status .od-Restore-status-image{height:208px;width:208px}.od-Restore-status .od-Restore-status-title{font-size:17px;font-weight:300}.od-Restore-status .od-Restore-progress-indicator{width:280px;margin:0 auto 16px auto}.od-Restore-status .od-Restore-back-to-onedrive-button{display:block;margin-bottom:16px}@media screen and (max-width:639.99999px){.od-Restore{padding:0 16px}}.od-Restore-disabled-navigation{margin:auto;width:40%;display:flex;flex-wrap:wrap;justify-content:center}.od-Restore-disabled-navigation .od-Restore-disabled-button{margin:20px}.od-restore-vaultVerification-page{text-align:center;padding-top:95px}.od-restore-vaultVerification-page .ms-Button--primary{margin:20px}.od-restore-vaultVerification-page .od-Restore-vaultVerification-image{height:208px;width:208px}"}]);});